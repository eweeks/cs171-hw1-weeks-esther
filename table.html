<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS171 Homework 1</title>

  <style type="text/css">
  /* YOUR CSS */
  .evenZebra{
  	color: blue;
  	background-color:yellow;
  }
  
  .oddZebra{
  	color: white;
  	background-color:black;
  
  }
  
  #hover{
  	color: black;
  	background-color: grey;
  
  }
  
  #test{
  	background-color:green;
  
  }
  
  tr th {
  cursor: s-resize;
  }
  
  </style>
</head>
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script>
  //variables
  var title = "Unemployment Rates for States";
  var tcaption = "Unemployment Rates for States Monthly Rankings Seasonally Adjusted Dec. 2013";
  //var stateSort = false;
  //var otherSort = false;
  var ace =3;
  var num = 3;
  //var sets which column data will initially be sorted by, and is
  //updated to mark which column data is sorted by
  var sorted =0;
  var cursor = "s-resize";
  var col2=new Array();
  var min;
  var max;
  
  
  
  d3.text("unemp_states_us_nov_2013.tsv", function(text){
		
		var parsed = d3.tsv.parseRows(text);
		//console.log(parsed[2][2] +" is parsed");
		var h1 = d3.select("body").append("h1").text(title);
		
		var table = d3.select("body").append("table"),
			caption = table.append("caption").text(tcaption);
			thead = table.append("thead");
     	 	tbody = table.append("tbody");

		
		//Create Header
		table.selectAll("thead")
					.append("tr");
					
		var header = thead.selectAll("tr")
		//	.append("th");
		
		var head = parsed.shift();
		
		////get min and max
		//console.log(parsed.forEach(function(d){
		//	d.column1 = d.column1;
		
		//}
		//) );
		
		/*var color = d3.scale.linear()
  			.domain([min, max])
  			.interpolate(d3.interpolateRgb)
  			.range(["orangered", "silver"]);*/		
		
		header.selectAll("th")
			.data(head)
			.enter()
			.append("th")
			.text(function(d) { return d; });
		
		//trying on click function
			/*	var sortColumn = function(a, b) {
				sort(function(a, b){
					return d3.ascending(a[1], b[1]);
					console.log("ran");
					});
				};
		
		*/
		
		//compare numbers
		
		//function compareNumbers(a, b) {
 		//	return a - b;
		//};
		//function for sorting
		function sortCol(d, i) {
				//console.log("Clicked");
				//console.log(" i is" + i+"d is "+ d);
				sorted = i;
				//console.log("sorted is " + i);
				if(i==3){
					
					i=0;
				}
				//This works, but could clean up how it is triggered, for example
				//setting a class to trigger instead of Var
				if(i==1){
					if(ace!=1){
  						ace=1;
						tbody.selectAll("tr").sort(function(a, b) {
  							//cursor = "s-resize";
  							thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  							return d3.ascending(a[1], b[1]);
  						});
  							//thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  							//console.log(thead.select("th:nth-child("+i+2+")"));
  						}else{
  							ace=2;
  							tbody.selectAll("tr").sort(function(a, b) {
  								//cursor = "n-resize";
  								//console.log("curs " + cursor);
  								thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  								return d3.descending(a[1], b[1]);
  							});
  						}
  					
  					
  				}else{
  					 //ascending sort with numbers
  					 if(num!=1){
  					 	num=1;
  					 	tbody.selectAll("tr").sort(function(a, b){
  					 	 //console.log(tbody.selectAll("tr"));
  					 	 //console.log("b is " + b[0]);
  					 	// console.log(" i is" + i);
  					 	 //return compareNumbers(d3.ascending(a[0], b[0]) );
  					 	 //cursor = "s-resize";
  					 	 if ( d3.ascending(a[i], b[i]) == 0){
  					  		//console.log("tie A is " + a[i] + " b is " + b[i]);
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "s-resize");
  					  		
  					  		return d3.ascending(a[1], b[1]);
  					  	}else{
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "s-resize");
  					  		return d3.ascending(a[i], b[i]);
  					  	}
  					  	
  					  });//end sort
  					 
  					 //descending sort with numbers
  					  }else{
  					  	num=2;
  					 	tbody.selectAll("tr").sort(function(a, b){
  					 
  					 	 if ( d3.descending(a[i], b[i]) == 0){
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "n-resize");
  					  		return d3.descending(a[1], b[1]);
  					  	}else{
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "n-resize");
  					  		return d3.descending(a[i], b[i]);
  					  	}
  					
  					  });//end sort  					  	
  					  }
  				}
				
				
				//stateSort = true;
				tbody.selectAll("tr")
				.attr("class", function(d, i) {
      				if(i%2==0){
      					return "evenZebra"
      				}else{
      					return"oddZebra"
      				}
      			});
				//rows;
			//});		
		
		}		
		//on click sort
		header.selectAll("th")
			.on("click", sortCol)
			//.on("mouseover", function(d, i){
				//d3.select(this).style("cursor", cursor)
			//})

		
		//Fills in body of table
      
      
		//Adds rows to table      
      	var rows = tbody.selectAll("tr")
      	.data(parsed)
      	.enter()
      	.append("tr")
      	.attr("class", function(d, i) {
      		if(i%2==0){
      		return "evenZebra"
      		}else{
      			return"oddZebra"
      		}
      	})
      	.on('mouseover', function(d){
      		d3.select(this).attr('id', 'hover')
      	})
      	.on('mouseout', function(d){
      		d3.select(this).attr("id", '')
      			
      	})
      	/*.sort(function(a, b) {
  			if(stateSort==true){
  				return d3.ascending(a[1], b[1]);
  			}
  			else{
  				return compareNumbers(a, b);
  			}
		})*/;
      	
      	

      	var cells = rows.selectAll("td")
     	
     	 .data(function(row) {
       		 return d3.range(Object.keys(row).length).map(function(column, i) {
        	//console.log("row is " + row[0]);
        	//this goes through each "row" of data, in this case it each row has 3 items, 
        	//and returns the i location in each row, thus filling in
        	//all the columns in that row
        	//console.log("output is "+row[Object.keys(row)[i]]);
        	//console.log("i is " + i);
        	//columns=columns + column;
        	
        	//parse info here to number if in row that is not a state name
        	if(i!=1){
        		//console.log("Zero");
        		//console.log(row[Object.keys(row)[i]] );
        		row[Object.keys(row)[i]] = parseFloat(row[Object.keys(row)[i]] );
        		//console.log("type is " + typeof(row[Object.keys(row)[i]] ));
        		
        		if(i==2){
        			col2.push(row[Object.keys(row)[i]] );
        			//console.log("Max is " + d3.max(max) );
        		}
        	
        	}
        	sortCol(row[i], sorted);
        	//console.log("i is "+i);
        	min=d3.min(col2);
        	//console.log("min is " + min);
        	max=d3.max(col2);
        	//console.log("d is " + function(d){d[2]});
        	return row[Object.keys(row)[i]];
          });
          
        })
      .enter()
      .append("td")
      .attr("name", function(d, i){
      	//console.log(d +"is");
      	return "col"+i;
      	
      })
      /*.style("background-color", function(d, i){
      		if(d3.select(this).attr("name") == "col2"){
      			//console.log("i is "+i);
      			return color(d);
      		}
      })*/
      
      
      .text(function(d) { return d; })
      
       .on('mouseover', function(d,i){
               //d3.selectAll(columns)
                //.attr('id', 'test');
                var holder = d3.select(this).attr("name");
                d3.selectAll("td").attr('id', 
                	function(d){
                		if (d3.select(this).attr("name") == holder){
                			return "hover";
                		}else{
                			return""
                		}
                	}
                );
            })
        .on('mouseout', function(d){
      		d3.selectAll("td").attr("id", '')
      			
      	});
		
		/*var color = d3.scale.linear()
  			.domain([0, tbody.selectAll("tr")[0].length-1])
  			.interpolate(d3.interpolateRgb)
  			.range(["orangered", "silver"]);*/
  		
  		//console.log(color(25));
  		//console.log(tbody.selectAll("tr")[0].length-1);
  		
  				//tbody.selectAll
  				
  				var color = d3.scale.linear()
  			.domain([min, max])
  			.interpolate(d3.interpolateRgb)
  			.range(["orangered", "silver"]);
  			
  			//console.log("Rows " + rows.selectAll("td") );
  			
  			rows.selectAll("td")
  			.style("background-color", function(d){
      		//console.log("d is "+d);
      			if(d3.select(this).attr("name") == "col2"){
      				//console.log("d is "+d);
      				return color(d);
      			}
      		})
      
      
      
      
      rows.insert("td")
    .attr("name", function(d){
      	return "col3";
      })
    .on('mouseover', function(d,i){
        var holder = d3.select(this).attr("name");
        d3.selectAll("td").attr('id', function(d){
        	if (d3.select(this).attr("name") == holder){
                return "hover";
             }else{
                return""
              }
         });
    })
    .on('mouseout', function(d){
      	d3.selectAll("td").attr("id", '')
      			
    })  
	.append("svg")
   .attr("width", 100)
   .attr("height", 20)
   .append("rect")
   .attr("height", 30)
   .attr("width", function(d) { 
   //	console.log("D at 0 is " + d[2]);
   	return parseFloat(d[0]); })
      
      
      thead.select("tr")
			.insert("th")
			.text("Chart")
			.on("click", sortCol);
			

      
	});
	
	
	//d3.select("thead").select("tr").insert("th")
	//	.text("New!");
		

	
	
	
  </script>
  <div style ="color: #ff4500;"> </div>
  <div style ="color: #f25e26;"> </div>
  <div style ="color: #42ffff;"> </div>
</body>

</html>
