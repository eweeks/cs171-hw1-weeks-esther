<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS171 Homework 1</title>

  <style type="text/css">
  /* YOUR CSS */
  .evenZebra{
  	color: blue;
  	background-color:yellow;
  }
  
  .oddZebra{
  	color: white;
  	background-color:black;
  
  }
  
  #hover{
  	color: black;
  	background-color: grey;
  
  }
  
  #test{
  	background-color:green;
  
  }
  
  tr th {
  cursor: s-resize;
  }
  
  </style>
</head>
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script>
 
  //variables
  var title = "Unemployment Rates for States";
  var tcaption = "Unemployment Rates for States Monthly Rankings Seasonally Adjusted Dec. 2013";
  var aSort =3;
  var nSort = 3;
  //var sets which column data will initially be sorted by, and is
  //updated to mark which column data is sorted by
  var sorted =0;
  var cursor = "s-resize";
  var col2=new Array();
  var min;
  var max;
  
  
  
  d3.text("unemp_states_us_nov_2013.tsv", function(text){
		
		var parsed = d3.tsv.parseRows(text);
		//console.log(parsed[2][2] +" is parsed");
		var h1 = d3.select("body").append("h1").text(title);
		
		var table = d3.select("body").append("table"),
			caption = table.append("caption").text(tcaption);
			thead = table.append("thead");
     	 	tbody = table.append("tbody");

		
		//Create Header
		table.selectAll("thead")
					.append("tr");
					
		var header = thead.selectAll("tr");
		var head = parsed.shift();		
		
		header.selectAll("th")
			.data(head)
			.enter()
			.append("th")
			.text(function(d) { return d; });

		//function for sorting
		function sortCol(d, i) {
				console.log("d is "+ d);
				sorted = i;
				if(i==3){
					i=0;
				}
				//This works, but could clean up how it is triggered, for example
				//setting a class to trigger instead of Var
				if(i==1){
					if(aSort!=1){
  						aSort=1;
						tbody.selectAll("tr").sort(function(a, b) {
  							thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  							return d3.ascending(a[1], b[1]);
  						});
  							
  						}else{
  							aSort=2;
  							tbody.selectAll("tr").sort(function(a, b) {
  								thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  								return d3.descending(a[1], b[1]);
  							});
  						}
  					
  					
  				}else{
  					 //ascending sort with numbers
  					 if(nSort!=1){
  					 	nSort=1;
  					 	tbody.selectAll("tr").sort(function(a, b){
  					 	 if ( d3.ascending(a[i], b[i]) == 0){
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "s-resize");
  					  		
  					  		return d3.ascending(a[1], b[1]);
  					  	}else{
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "s-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "s-resize");
  					  		return d3.ascending(a[i], b[i]);
  					  	}
  					  	
  					  });//end sort
  					 
  					 //descending sort with numbers
  					  }else{
  					  	nSort=2;
  					 	tbody.selectAll("tr").sort(function(a, b){
  					 
  					 	 if ( d3.descending(a[i], b[i]) == 0){
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "n-resize");
  					  		return d3.descending(a[1], b[1]);
  					  	}else{
  					  		thead.select("th:nth-of-type("+(i+1)+")").style("cursor", "n-resize");
  					  		thead.select("th:nth-of-type(4)").style("cursor", "n-resize");
  					  		return d3.descending(a[i], b[i]);
  					  	}
  							
  						
  					  });//end sort  					  	
  					  }
  				}
				
				
				//stateSort = true;
				tbody.selectAll("tr")
				.attr("class", function(d, i) {
      				if(i%2==0){
      					return "evenZebra"
      				}else{
      					return"oddZebra"
      				}
      			});
		
		
		}		
		//on click sort
		header.selectAll("th")
			.on("click", sortCol)

		
		//Fills in body of table
      
      
		//Adds rows to table      
      	var rows = tbody.selectAll("tr")
      	.data(parsed)
      	.enter()
      	.append("tr")
      	.attr("class", function(d, i) {
      		if(i%2==0){
      		return "evenZebra"
      		}else{
      			return"oddZebra"
      		}
      	})
      	.on('mouseover', function(d){
      		d3.select(this).attr('id', 'hover')
      	})
      	.on('mouseout', function(d){
      		d3.select(this).attr("id", '')
      			
      	});
      	
      	

      	var cells = rows.selectAll("td")
     	
     	 .data(function(row) {
       		 return d3.range(Object.keys(row).length).map(function(column, i) {

        	//this goes through each "row" of data, in this case it each row has 3 items, 
        	//and returns the i location in each row, thus filling in
        	//all the columns in that row

        	
        	//parse info here to number if in row that is not a state name
        	if(i!=1){
        		//console.log("Zero");
        		//console.log(row[Object.keys(row)[i]] );
        		row[Object.keys(row)[i]] = parseFloat(row[Object.keys(row)[i]] );
        		
        		if(i==2){
        			col2.push(row[Object.keys(row)[i]] );
        		}
        	
        	}
        	sortCol(row[i], sorted);
        	min=d3.min(col2);
        	max=d3.max(col2);
        	return row[Object.keys(row)[i]];
          });
          
        })
      .enter()
      .append("td")
      .attr("name", function(d, i){
      	return "col"+i;
      	
      })
      
      
      .text(function(d) { return d; })
      
       .on('mouseover', function(d,i){
               //d3.selectAll(columns)
                //.attr('id', 'test');
                var holder = d3.select(this).attr("name");
                d3.selectAll("td").attr('id', 
                	function(d){
                		if (d3.select(this).attr("name") == holder){
                			return "hover";
                		}else{
                			return""
                		}
                	}
                );
            })
        .on('mouseout', function(d){
      		d3.selectAll("td").attr("id", '')
      			
      	});
  				
  				var color = d3.scale.linear()
  			.domain([min, max])
  			.interpolate(d3.interpolateRgb)
  			.range(["orangered", "silver"]);
  			
  			rows.selectAll("td")
  			.style("background-color", function(d){
      			if(d3.select(this).attr("name") == "col2"){
      				return color(d);
      			}
      		})
   
      rows.insert("td")
    .attr("name", function(d){
      	return "col3";
      })
    .on('mouseover', function(d,i){
        var holder = d3.select(this).attr("name");
        d3.selectAll("td").attr('id', function(d){
        	if (d3.select(this).attr("name") == holder){
                return "hover";
             }else{
                return""
              }
         });
    })
    .on('mouseout', function(d){
      	d3.selectAll("td").attr("id", '')
      			
    })  
	.append("svg")
   .attr("width", 100)
   .attr("height", 20)
   .append("rect")
   .attr("height", 30)
   .attr("width", function(d) { 

   	return parseFloat(d[0]); })
      
      
      thead.select("tr")
			.insert("th")
			.text("Chart")
			.on("click", sortCol);
			
	});

  </script>

</body>

</html>
